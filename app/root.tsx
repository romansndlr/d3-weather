import { NuqsAdapter } from "nuqs/adapters/react-router/v7";
import {
  Links,
  Meta,
  Outlet,
  Scripts,
  ScrollRestoration,
  isRouteErrorResponse,
} from "react-router";
import type { Route } from "./+types/root";

import "./app.css";
import { format } from "date-fns";
import { CloudIcon, GroundcoverLogo } from "./components/icons";

export function Layout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className="h-full">
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <Meta />
        <Links />
      </head>
      <body className="h-full overflow-x-hidden bg-linear-to-b from-blue-200 to-blue-400 bg-no-repeat">
        <CloudIcon className="-left-32 fixed top-1/3 h-44 animate-float" />
        <CloudIcon className="-right-36 fixed top-2/3 h-44 animate-float-slow" />
        <main className="mx-auto flex h-full justify-center overflow-hidden pt-20 text-slate-900">
          <div className="relative w-1/2">
            <header className="-top-28 absolute right-0 flex items-end gap-x-4">
              <div className="flex flex-col items-end gap-3">
                <h1>
                  <svg
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="140"
                    height="21"
                    viewBox="0 0 140 21"
                    fill="none"
                    className="h-6 w-40"
                  >
                    <path
                      d="M6.26293 6.38516C8.22009 6.38516 9.17072 7.1833 9.17072 8.53189C9.17072 9.85296 8.35989 10.6511 6.29089 10.6511C4.22188 10.6511 3.46698 9.82544 3.46698 8.53189C3.46698 7.23835 4.24984 6.38516 6.26293 6.38516ZM6.4866 18.7977C3.13146 18.7977 2.3486 18.4399 2.3486 17.4491C2.3486 16.8161 2.96371 16.1831 4.33372 16.1831H9.36643C10.4569 16.1831 10.8203 16.6785 10.8203 17.2564C10.8203 18.3023 10.0654 18.7977 6.4866 18.7977ZM6.54252 20.9995C11.5193 21.027 13.2248 19.6784 13.2248 17.2564C13.2248 15.2473 12.0505 14.0363 9.25459 14.0363C7.8007 14.0363 6.12313 14.1189 4.5574 14.1189C3.77453 14.1189 3.41106 13.9263 3.41106 13.4309C3.41106 13.2107 3.55086 13.0455 3.71861 12.7703L3.99821 12.33C4.66924 12.5226 5.42414 12.6052 6.26293 12.6052C9.84174 12.6052 11.771 11.4217 11.771 9.13738C11.771 7.40348 10.5407 6.71543 8.91908 6.41268V6.38516C9.84174 6.44021 10.4848 6.4402 11.1279 6.4402H12.8334V3.93568H6.40273C2.85187 3.93568 0.754907 5.53197 0.754907 8.36676C0.754907 10.2933 1.81737 11.6694 3.77453 12.2749L2.76799 12.7153C1.70553 13.0731 1.11838 13.7611 1.11838 14.4217C1.11838 15.3849 1.84533 15.9904 3.13146 16.1556C1.09042 16.4033 0 17.2564 0 18.3573C0 19.9811 1.42593 21.027 6.54252 20.9995Z"
                      fill="#101828"
                    />
                    <path
                      d="M17.1608 16.8711V10.3208C17.1608 8.06402 18.0835 7.26587 20.4321 7.26587H21.7182V3.93568H20.9633C18.9782 3.93568 17.8039 4.81639 17.2167 8.17411H17.1608V3.93568H14.1412V16.8711H17.1608Z"
                      fill="#101828"
                    />
                    <path
                      d="M28.7006 17.2289C32.8666 17.2289 35.4109 14.6143 35.4109 10.3759C35.4109 6.10994 32.7268 3.60541 28.7006 3.60541C24.6465 3.60541 21.9624 6.10994 21.9624 10.3759C21.9624 14.6143 24.4788 17.2289 28.7006 17.2289ZM28.7006 6.30259C31.0213 6.30259 32.4193 7.87136 32.4193 10.3484C32.4193 12.8529 31.0772 14.5042 28.6727 14.5042C26.2961 14.5042 24.982 12.8529 24.982 10.3484C24.982 7.87136 26.352 6.30259 28.7006 6.30259Z"
                      fill="#101828"
                    />
                    <path
                      d="M45.4731 16.8711H48.4927V3.93568H45.4731V11.5869C45.4731 13.4309 44.2988 14.5317 42.3696 14.5317C40.3285 14.5317 39.6295 13.1556 39.6295 11.5869V3.93568H36.6099V12.385C36.6099 15.1648 37.8122 17.2289 40.9716 17.2289C43.1804 17.2289 44.858 16.1005 45.4451 13.3208H45.4731V16.8711Z"
                      fill="#101828"
                    />
                    <path
                      d="M53.4754 9.21995C53.4754 7.37596 54.6497 6.27507 56.5789 6.27507C58.6199 6.27507 59.3189 7.65118 59.3189 9.21995V16.8711H62.3385V8.44933C62.3385 5.64206 61.1363 3.60541 57.9769 3.60541C55.7681 3.60541 54.0905 4.73383 53.5033 7.48605H53.4754V3.93568H50.4558V16.8711H53.4754V9.21995Z"
                      fill="#101828"
                    />
                    <path
                      d="M69.9494 14.5317C67.6008 14.5317 66.5384 13.0455 66.5384 10.4585C66.5384 7.78879 67.6567 6.24755 69.9494 6.24755C72.1023 6.24755 73.4444 7.84384 73.4444 10.3208V10.541C73.4444 13.1006 72.1023 14.5317 69.9494 14.5317ZM73.4444 16.8711H76.464V0H73.4444V7.65118H73.4164C72.8293 4.98153 71.3474 3.57789 68.7192 3.60541C65.42 3.57789 63.5467 6.16498 63.5467 10.4585C63.5467 14.6418 65.3082 17.2289 68.7192 17.2289C71.2635 17.2289 72.8013 15.8253 73.3885 13.2107H73.4444V16.8711Z"
                      fill="#101828"
                    />
                    <path
                      d="M87.9215 9.33004L90.8293 8.86216C90.298 5.53197 88.4807 3.60541 84.5384 3.60541C80.5402 3.60541 77.7722 6.13746 77.7722 10.4309C77.7722 14.8345 80.4843 17.2289 84.6223 17.2289C88.4248 17.2289 90.326 15.1648 90.8572 11.8621L87.9774 11.2841C87.558 13.1281 86.7752 14.5042 84.5664 14.5042C82.3296 14.5042 80.8477 13.0455 80.8477 10.4034C80.8477 7.62366 82.3575 6.30259 84.5104 6.30259C86.5515 6.30259 87.5301 7.51357 87.9215 9.33004Z"
                      fill="#101828"
                    />
                    <path
                      d="M98.299 17.2289C102.465 17.2289 105.009 14.6143 105.009 10.3759C105.009 6.10994 102.325 3.60541 98.299 3.60541C94.2449 3.60541 91.5608 6.10994 91.5608 10.3759C91.5608 14.6143 94.0772 17.2289 98.299 17.2289ZM98.299 6.30259C100.62 6.30259 102.018 7.87136 102.018 10.3484C102.018 12.8529 100.676 14.5042 98.2711 14.5042C95.8945 14.5042 94.5804 12.8529 94.5804 10.3484C94.5804 7.87136 95.9505 6.30259 98.299 6.30259Z"
                      fill="#101828"
                    />
                    <path
                      d="M113.45 16.8711L118.594 3.93568H115.435L113.618 8.94473C113.002 10.6786 112.359 12.5226 111.772 14.174H111.716C111.157 12.5226 110.486 10.6786 109.871 8.94473L108.082 3.93568H104.81L110.011 16.8711H113.45Z"
                      fill="#101828"
                    />
                    <path
                      d="M124.973 6.10994C127.042 6.10994 128.104 7.15578 128.272 9.16491H121.394C121.729 7.07322 122.988 6.10994 124.973 6.10994ZM125.057 17.2014C128.523 17.2014 130.313 15.495 130.984 13.018L128.356 12.2749C127.964 13.596 127.181 14.6143 125.084 14.6143C122.932 14.6143 121.645 13.5409 121.366 11.3667H131.012C131.068 10.6786 131.068 10.1557 131.068 9.63278C131.068 6.08242 129.055 3.60541 125.057 3.60541C120.974 3.60541 118.346 6.1925 118.346 10.5685C118.346 14.8345 121.03 17.2014 125.057 17.2014Z"
                      fill="#101828"
                    />
                    <path
                      d="M135.443 16.8711V10.3208C135.443 8.06402 136.365 7.26587 138.714 7.26587H140V3.93568H139.245C137.26 3.93568 136.086 4.81639 135.499 8.17411H135.443V3.93568H132.423V16.8711H135.443Z"
                      fill="#101828"
                    />
                  </svg>
                  <span className="sr-only">Groundcover</span>
                </h1>
                <div className="text-right">
                  <h2 className="text-lg leading-tight">Weather</h2>
                  <span className="text-slate-800 text-sm">
                    {format(new Date(), "eeee hh:mm a")}
                  </span>
                </div>
              </div>
              <GroundcoverLogo />
            </header>
            {children}
          </div>
        </main>
        <ScrollRestoration />
        <Scripts />
      </body>
    </html>
  );
}

export default function App() {
  return (
    <NuqsAdapter>
      <Outlet />
    </NuqsAdapter>
  );
}

export function ErrorBoundary({ error }: Route.ErrorBoundaryProps) {
  let message = "Oops!";
  let details = "An unexpected error occurred.";
  let stack: string | undefined;

  if (isRouteErrorResponse(error)) {
    message = error.status === 404 ? "404" : "Error";
    details =
      error.status === 404
        ? "The requested page could not be found."
        : error.statusText || details;
  } else if (import.meta.env.DEV && error && error instanceof Error) {
    details = error.message;
    stack = error.stack;
  }

  return (
    <main className="container mx-auto p-4 pt-16">
      <h1>{message}</h1>
      <p>{details}</p>
      {stack && (
        <pre className="w-full overflow-x-auto p-4">
          <code>{stack}</code>
        </pre>
      )}
    </main>
  );
}
